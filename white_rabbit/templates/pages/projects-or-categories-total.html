{% extends "base.html" %}
{% load white_rabbit_tags %}
{% load cache %}
{% load static %}

{% block content %}
  <div class="border-b border-gray-200">
    <nav aria-label="Tabs" role="tablist">
      {% for period in periods %}
        <a type="button"
            {% if group_by == 'project' %}
           href="{% url 'projects' period.key %}"
            {% else %}
           href="{% url 'categories' period.key %}"
            {% endif %}
           class="tab {% if current_period_key == period.key %}text-base font-bold{% endif %}"
           id="tabs-with-badges-item-{{ period.key | slugify }}"
           data-hs-tab="#tabs-with-badges-{{ period.key | slugify }}"
           aria-controls="tabs-with-badges-{{ period.key | slugify }}"
           role="tab">
          {% if period.label %}
            {{ period.label|title }}
          {% else %}
            {{ period.key|format_date }}
          {% endif %}
        </a>
      {% endfor %}
    </nav>
  </div>
  <div class="mt-3">
    <table
        class="border border-gray-200 border-separate rounded-lg divide-y divide-gray-200">
      <thead class="bg-gray-50">
      <tr class="font-bold bg-indigo-50 text-black uppercase text-xs">
        <th class="p-4 sticky z-50 left-0 bg-indigo-50 w-[150px]">Nom du projet</th>
        <th class="p-4 sticky z-50 left-[120px] bg-indigo-50">Total</th>
        {% for employee_name in employees_names %}
          <th class="p-4 text-gray-800">
            {{ employee_name }}
          </th>
        {% endfor %}
      </tr>
      </thead>

      <tbody class="divide-y divide-gray-200">
      {% for identifier in identifier_order %}
        <tr>
          <th scope="row"
              class="font-bold bg-gray-100 left-0 sticky z-50 text-sm">
            {% if group_by == "project" %}
              {{ identifier|find_project_name:details_data }}
            {% else %}
              {{ identifier }}
            {% endif %}
          </th>
          <td class="sticky left-[120px] min-w-[150px] z-50 bg-white text-center">
            {{ total_per_identifier|get_item:identifier|floatformat:1 }}
            jour{{ total_per_identifier|get_item:identifier|pluralize:'s' }}
          </td>
          {% for employee_name in employees_names %}
            <td>
              {% with employees_events|get_item:employee_name|get_item:identifier as data %}
                <div tabindex="0" class="collapse text-center">
                  <div class="collapse-title">
                    {% if data.duration %}
                      {{ data.duration|floatformat:1 }}
                      jour{{ data.duration|pluralize:'s' }}
                    {% endif %}

                  </div>
                  {% if data.events %}
                    <div
                        class="collapse-content bg-gray-100 min-w-[150px] rounded-xl">
                      <ul>
                        {% for event in data.events %}
                          <li>
                            <span>{{ event.duration|floatformat:1 }}h</span> le
                            <span>{{ event.date|date:"d/m/Y" }}</span>
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}

                </div>
              {% endwith %}
            </td>
          {% endfor %}
        </tr>

      {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}